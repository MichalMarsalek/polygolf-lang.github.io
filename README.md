## PolyGolf Playground

Compiles [PolyGolf](https://github.com/jared-hughes/polygolf) to [code.golf](https://code.golf) languages in your browser.

Link: [btnlq.github.io/polygolf-web/](https://btnlq.github.io/polygolf-web/)

### Development

The `polygolf.bundle.js` file is generated by running
```
esbuild src/polygolf.ts --bundle --outfile=polygolf.bundle.js
```
in [the PolyGolf project](https://github.com/jared-hughes/polygolf) where `src/polygolf.ts` is
```ts
import compile from "./common/compile";
import { getObjectiveFunc } from "./common/objective";
import languages from "./languages/languages";

globalThis.compile = compile;
globalThis.getObjectiveFunc = getObjectiveFunc;
globalThis.languages = languages;

// Node.js polyfill
globalThis.Buffer = {
  from(s: string, encoding: string) {
    return new TextEncoder().encode(s);
  },
  byteLength(s: string, encoding: string) {
    // return new TextEncoder().encode(s).length;
    let length = s.length;
    for (let i = length - 1; i >= 0; i--) {
      const code = s.charCodeAt(i);
      if (code > 0x7f) {
        length += code > 0x7ff ? 2 : 1;
        if (code >= 0xDC00 && code <= 0xDFFF) i--; // surrogate
      }
    }
    return length;
  }
};
```

The `codemirror.bundle.js` file is generated by running
```sh
npm install codemirror rollup @rollup/plugin-node-resolve @rollup/plugin-terser
node_modules/.bin/rollup codemirror.js -f iife -n CodeMirror -o codemirror.bundle.js -p @rollup/plugin-node-resolve -p @rollup/plugin-terser
```
where `codemirror.js` is
```js
import { EditorView, lineNumbers, highlightSpecialChars, drawSelection, highlightActiveLine, keymap } from '@codemirror/view';
import { highlightSelectionMatches } from '@codemirror/search';
import { syntaxHighlighting, defaultHighlightStyle, bracketMatching } from '@codemirror/language';
import { history, defaultKeymap, historyKeymap, indentLess, insertTab } from '@codemirror/commands';

export function initEditor(parent, initialValue, onChange) {
  return new EditorView({
    doc: initialValue,
    extensions: [
      lineNumbers(),
      highlightSpecialChars(),
      history(),
      drawSelection(),
      syntaxHighlighting(defaultHighlightStyle, { fallback: true }),
      bracketMatching(),
      highlightActiveLine(),
      highlightSelectionMatches(),
      keymap.of([
        ...defaultKeymap,
        ...historyKeymap,
        { key: 'Tab', run: insertTab, shift: indentLess },
      ]),
      EditorView.lineWrapping,
      EditorView.updateListener.of((v) => {
        if (v.docChanged) {
          onChange(v.state.doc.toString());
        }
      })
    ],
    parent
  });
}
```
